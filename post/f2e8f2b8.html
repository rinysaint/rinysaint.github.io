
<!DOCTYPE html>
<html lang="zh-Hans" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>如何在Zuul上实现CAS的单点登录 - 肖日宁的世界</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <meta name="keywords" content="肖日宁,君子兰,人工智能,AI,机器学习,博客,大数据,微服务,xiaorining,kingslanding,"> 
    <meta name="description" content="肖日宁,君子兰,人工智能,AI,机器学习,博客,大数据,微服务,xiaorining,kingslanding,前言最近项目跟一个基于CAS的系统对接做单点登录，之前在传统框架做过CAS的对接，本来以为很简单，简单配置一下双方对好账户就完了，但现在系统架构调整为SpringCloud的微服务体系，这让这次对接,"> 
    <meta name="author" content="肖日宁"> 
    <link rel="alternative" href="atom.xml" title="肖日宁的世界" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
<link rel="stylesheet" href="/css/diaspora.css">
<link rel="stylesheet" href="/css/APlayer.min.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">肖日宁的世界</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://kingslanding.cn"></a>
        <!-- page音乐插件 -->
        
    <h3 class="subtitle">如何在Zuul上实现CAS的单点登录</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">如何在Zuul上实现CAS的单点登录</h1>
        <div class="stuff">
            <span>九月 28, 2018</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1-%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95-zuul/" rel="tag">微服务,单点登录,zuul</a></li></ul>


        </div>
        <div class="content markdown">
            <p>前言<br>最近项目跟一个基于CAS的系统对接做单点登录，之前在传统框架做过CAS的对接，本来以为很简单，简单配置一下双方对好账户就完了，但现在系统架构调整为SpringCloud的微服务体系，这让这次对接就不那么简单直接的。本文主要讨论CAS与Zuul上的结合思路。</p>
<p>CAS原理<br>CAS的基本原理还是挺简单的，如下图所示。</p>
<p><img src="/../images/%E5%A6%82%E4%BD%95%E5%9C%A8Zuul%E4%B8%8A%E5%AE%9E%E7%8E%B0CAS%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/20170516192351510" alt="img"></p>
<p>主要就是<br>1.拦截重定向<br>2.登录<br>3.验证<br>4.获取用户信息<br>看着挺复杂，但其实框架已经把大部分工作都做好了，封装起来了，正常情况下我们只需要配置一下就ok了，但在微服务的环境下还是挺让人迷惑的。<br>对了我们用的是CAS3.5版本搭建的测试系统。</p>
<p>实现思路<br>Zuul作为整个系统的网关，有几样工作特别适合：<br>1.路由，Zuul的天职<br>2.负载均衡，Zuul 2.0的性能还是可以期待的<br>3.日志，由于外部的请求都经过Zuul因此它的日志处理是非常重要和必要的<br>4.鉴权，同样由于外部服务都经过Zuul，鉴权也是非常合适的，因此对于SpringCloud体系来说做CAS的单点登录的集成Zuul是最合适不过的。</p>
<p>我们Zuul也是基于SpringBoot，因此可以使用Spring Security的套路实现CAS的拦截与验证等工作。<br>简单的总结一下：<br>1.将CAS集成放到Zuul上<br>2.使用Spring Security套餐</p>
<p>但同时我们也知道Zuul还要处理日志，因此要将CAS与Zuul本身的职责协调好，同时我们也都知道Zuul核心是ZuulFilter，而SpringSecurity实质上也是一系列的Filter来处理，把这两套Fillter理清楚是搞定这个问题的先决条件。</p>
<p>下面我们就结合具体代码看看怎么解决这个问题。</p>
<h1 id="实例代码"><a href="#实例代码" class="headerlink" title="实例代码"></a>实例代码</h1><p>首先是工程目录，maven的惯例</p>
<p><img src="/../images/%E5%A6%82%E4%BD%95%E5%9C%A8Zuul%E4%B8%8A%E5%AE%9E%E7%8E%B0CAS%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/20180611224238197" alt="img"></p>
<p>ps不要在意那个UserLoginInfoCache.java其实就是一个缓存。</p>
<p>然后是POM.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.zw.se2&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;demo-zuul&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;hy-zuul&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;description&gt;Demo project for Zuul and CAS&lt;&#x2F;description&gt;</span><br><span class="line"></span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.0.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">        &lt;spring-cloud.version&gt;Finchley.RC1&lt;&#x2F;spring-cloud.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-config&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-zuul&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;net.sf.json-lib&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;json-lib&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.4&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;classifier&gt;jdk15&lt;&#x2F;classifier&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.session&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-session&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.3.1.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-cas&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-taglibs&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-cloud-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;spring-milestones&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;name&gt;Spring Milestones&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;url&gt;https:&#x2F;&#x2F;repo.spring.io&#x2F;milestone&lt;&#x2F;url&gt;</span><br><span class="line">            &lt;snapshots&gt;</span><br><span class="line">                &lt;enabled&gt;false&lt;&#x2F;enabled&gt;</span><br><span class="line">            &lt;&#x2F;snapshots&gt;</span><br><span class="line">        &lt;&#x2F;repository&gt;</span><br><span class="line">    &lt;&#x2F;repositories&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<p>接下来是Zuul的配置<br>application.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#默认情况下，敏感的头信息无法经过API网关进行传递,需要开启。解决使用zuul网关后spring session无效问题</span><br><span class="line">zuul.routes.tim-service.sensitiveHeaders&#x3D;&quot;*&quot;</span><br><span class="line">zuul.routes.main-service.path&#x3D;&#x2F;main-service&#x2F;**</span><br><span class="line">zuul.routes.main-service.url&#x3D;http:&#x2F;&#x2F;localhost:8383 </span><br><span class="line">zuul.routes.main-service.sensitiveHeaders&#x3D;&quot;*&quot;</span><br><span class="line">devMode&#x3D;false</span><br><span class="line">spring.application.name&#x3D;demo-zuul-server</span><br><span class="line">#下面那个参数是去掉zuul-prefix参数产生的前缀的，跟path一毛钱关系都没有</span><br><span class="line">zuul.strip-prefix&#x3D;false</span><br><span class="line">server.port&#x3D;8085</span><br><span class="line"></span><br><span class="line">#将 hystrix 的超时时间禁用掉</span><br><span class="line">hystrix.command.default.execution.timeout.enabled&#x3D;false</span><br><span class="line">#session存储</span><br><span class="line">spring.session.store-type&#x3D;none</span><br><span class="line">#日志配置文件路径</span><br><span class="line">logging.config&#x3D;ext&#x2F;conf&#x2F;logback.xml</span><br><span class="line"></span><br><span class="line">#CAS服务地址</span><br><span class="line">cas.server.host.url&#x3D;http:&#x2F;&#x2F;10.0.4.53:8080&#x2F;cas-server-webapp-3.5.0</span><br><span class="line">#CAS服务登录地址</span><br><span class="line">cas.server.host.login_url&#x3D;$&#123;cas.server.host.url&#125;&#x2F;login</span><br><span class="line">#应用访问地址</span><br><span class="line">app.server.host.url&#x3D;http:&#x2F;&#x2F;localhost:8085</span><br><span class="line">#应用登录地址,这个URL不一定非要存在</span><br><span class="line">app.login.url&#x3D;&#x2F;cas&#x2F;login&#x2F;zuul</span><br></pre></td></tr></table></figure>

<p>接下来是启动配置bootstrap.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">        defaultZone: http:&#x2F;&#x2F;localhost:8797&#x2F;eureka</span><br><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    config:</span><br><span class="line">      uri: http:&#x2F;&#x2F;localhost:8888</span><br><span class="line">      profile: dev</span><br><span class="line">      name: hyConfig</span><br></pre></td></tr></table></figure>

<p>接下来就是cas了<br>CasProperties.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.zw.se2.hy.zuul.cas.config;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by ZEW on 2018&#x2F;6&#x2F;7.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">@Component</span><br><span class="line">public class CasProperties &#123;</span><br><span class="line">    @Value(&quot;$&#123;cas.server.host.url&#125;&quot;)</span><br><span class="line">    private String casServerUrl;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;cas.server.host.login_url&#125;&quot;)</span><br><span class="line">    private String casServerLoginUrl;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;app.server.host.url&#125;&quot;)</span><br><span class="line">    private String appServerUrl;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;app.login.url&#125;&quot;)</span><br><span class="line">    private String appLoginUrl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecurityConfig.java，这个是配置的核心，其中最核心的就是配置拦截策略和处理过滤器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">package com.zw.se2.hy.zuul.cas.config;</span><br><span class="line"></span><br><span class="line">import com.zw.se2.hy.zuul.cas.custom.CustomUserDetailsService;</span><br><span class="line">import org.jasig.cas.client.session.SingleSignOutFilter;</span><br><span class="line">import org.jasig.cas.client.validation.Cas20ServiceTicketValidator;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.security.cas.ServiceProperties;</span><br><span class="line">import org.springframework.security.cas.authentication.CasAssertionAuthenticationToken;</span><br><span class="line">import org.springframework.security.cas.authentication.CasAuthenticationProvider;</span><br><span class="line">import org.springframework.security.cas.web.CasAuthenticationEntryPoint;</span><br><span class="line">import org.springframework.security.cas.web.CasAuthenticationFilter;</span><br><span class="line">import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line">import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line">import org.springframework.security.core.userdetails.AuthenticationUserDetailsService;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by ZEW on 2018&#x2F;6&#x2F;7.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity &#x2F;&#x2F;启用web权限</span><br><span class="line">@EnableGlobalMethodSecurity(prePostEnabled &#x3D; true) &#x2F;&#x2F;启用方法验证</span><br><span class="line">public class SecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private CasProperties casProperties;</span><br><span class="line"></span><br><span class="line">    &#x2F;**定义认证用户信息获取来源，密码校验规则等*&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        super.configure(auth);</span><br><span class="line">        auth.authenticationProvider(casAuthenticationProvider());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**定义安全策略*&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http.authorizeRequests()&#x2F;&#x2F;配置安全策略</span><br><span class="line">                .antMatchers(&quot;&#x2F;**&#x2F;api&#x2F;**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;&#x2F;**&#x2F;**.html&quot;).permitAll()</span><br><span class="line">                .anyRequest().authenticated();&#x2F;&#x2F;定义&#x2F;请求不需要验证</span><br><span class="line"></span><br><span class="line">        http.exceptionHandling().authenticationEntryPoint(casAuthenticationEntryPoint())</span><br><span class="line">                .and()</span><br><span class="line">                .addFilter(casAuthenticationFilter())</span><br><span class="line">                .addFilterBefore(singleSignOutFilter(), CasAuthenticationFilter.class);</span><br><span class="line">&#x2F;&#x2F;这个地方需要注意，这里禁用是为了照顾需要使用post请求且这个请求是外部系统提供的，没有办法，</span><br><span class="line">&#x2F;&#x2F;为了安全还是推荐不禁用转而使用csrf-token的模式</span><br><span class="line">        http.csrf().disable(); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**认证的入口*&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public CasAuthenticationEntryPoint casAuthenticationEntryPoint() &#123;</span><br><span class="line">        CasAuthenticationEntryPoint casAuthenticationEntryPoint &#x3D; new CasAuthenticationEntryPoint();</span><br><span class="line">        casAuthenticationEntryPoint.setLoginUrl(casProperties.getCasServerLoginUrl());</span><br><span class="line">        casAuthenticationEntryPoint.setServiceProperties(serviceProperties());</span><br><span class="line">        return casAuthenticationEntryPoint;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**指定service相关信息*&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public ServiceProperties serviceProperties() &#123;</span><br><span class="line">        ServiceProperties serviceProperties &#x3D; new ServiceProperties();</span><br><span class="line">        serviceProperties.setService(casProperties.getAppServerUrl() + casProperties.getAppLoginUrl());</span><br><span class="line">        serviceProperties.setAuthenticateAllArtifacts(true);</span><br><span class="line">        return serviceProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**CAS认证过滤器*&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public CasAuthenticationFilter casAuthenticationFilter() throws Exception &#123;</span><br><span class="line">        CasAuthenticationFilter casAuthenticationFilter &#x3D; new CasAuthenticationFilter();</span><br><span class="line">        casAuthenticationFilter.setAuthenticationManager(authenticationManager());</span><br><span class="line">        casAuthenticationFilter.setFilterProcessesUrl(casProperties.getAppLoginUrl());</span><br><span class="line">        return casAuthenticationFilter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**cas 认证 Provider*&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public CasAuthenticationProvider casAuthenticationProvider() &#123;</span><br><span class="line">        CasAuthenticationProvider casAuthenticationProvider &#x3D; new CasAuthenticationProvider();</span><br><span class="line">       &#x2F;&#x2F;这里实现了一个自定义的认证服务，其实没有特殊需求可以采用默认的服务 casAuthenticationProvider.setAuthenticationUserDetailsService(customUserDetailsService());</span><br><span class="line"></span><br><span class="line">        casAuthenticationProvider.setServiceProperties(serviceProperties());</span><br><span class="line">        casAuthenticationProvider.setTicketValidator(cas20ServiceTicketValidator());</span><br><span class="line">        casAuthenticationProvider.setKey(&quot;an_id_for_this_auth_provider_only&quot;);</span><br><span class="line">        return casAuthenticationProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;*@Bean</span><br><span class="line">    public UserDetailsService customUserDetailsService()&#123;</span><br><span class="line">        return new CustomUserDetailsService();</span><br><span class="line">    &#125;*&#x2F;</span><br><span class="line"></span><br><span class="line">    &#x2F;**用户自定义的AuthenticationUserDetailsService*&#x2F;</span><br><span class="line">    @Bean</span><br><span class="line">    public AuthenticationUserDetailsService&lt;CasAssertionAuthenticationToken&gt; customUserDetailsService()&#123;</span><br><span class="line">        return new CustomUserDetailsService();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Cas20ServiceTicketValidator cas20ServiceTicketValidator() &#123;</span><br><span class="line">        return new Cas20ServiceTicketValidator(casProperties.getCasServerUrl());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于涉及业务，自定义的认证服务这里就不贴了，有兴趣的可以参考<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/cl_andywin/article/details/53998986">参考链接</a><br>但是请注意这篇文档在loadUserDetails函数中要对userInfo的权限相关信息赋值，否则就不能通过验证。<br>代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UserInfo userInfo &#x3D; new UserInfo();</span><br><span class="line">       userInfo.setUsername(token.getName());</span><br><span class="line">       userInfo.setName(token.getName());</span><br><span class="line">       Set&lt;AuthorityInfo&gt; authorities &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">       AuthorityInfo authorityInfo &#x3D; new AuthorityInfo(&quot;CAS&quot;);</span><br><span class="line">       authorities.add(authorityInfo);</span><br><span class="line">       userInfo.setAuthorities(authorities);</span><br><span class="line">       userInfo.setAccountNonLocked(true);</span><br><span class="line">       userInfo.setAccountNonExpired(true);</span><br><span class="line">       userInfo.setCredentialsNonExpired(true);</span><br></pre></td></tr></table></figure>

<p>集成完CAS，该处理Zuul本身的过滤器<br>经过试验CAS的过滤器优先级要高于Zuul的Pre过滤器，这样倒也方便了，只需要处理登录等日志即可。<br>也就是增加一个post过滤器。<br>如下所示 LoginResponseFilter.java.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">package com.zw.se2.hy.zuul.filter.post;</span><br><span class="line"></span><br><span class="line">import com.netflix.zuul.ZuulFilter;</span><br><span class="line">import com.netflix.zuul.context.RequestContext;</span><br><span class="line">import com.zw.se2.hy.zuul.UserLoginInfoCache;</span><br><span class="line">import com.zw.se2.hy.zuul.filter.ConstantPath;</span><br><span class="line">import net.sf.json.JSONArray;</span><br><span class="line">import net.sf.json.JSONObject;</span><br><span class="line">import org.apache.commons.lang.StringUtils;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.util.StreamUtils;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.Cookie;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpSession;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">import static org.springframework.util.ReflectionUtils.rethrowRuntimeException;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class LoginResponseFilter extends ZuulFilter &#123;</span><br><span class="line">      private static Logger log &#x3D; LoggerFactory.getLogger(&quot;monitor&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean shouldFilter() &#123;</span><br><span class="line">        RequestContext context &#x3D; RequestContext.getCurrentContext();</span><br><span class="line">        String url &#x3D; context.getRequest().getRequestURL().toString();</span><br><span class="line">        &#x2F;&#x2F;只处理登录请求</span><br><span class="line">        return StringUtils.endsWith(url, ConstantPath.LOGIN_PATH);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object run() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            RequestContext context &#x3D; RequestContext.getCurrentContext();</span><br><span class="line">            InputStream stream &#x3D; context.getResponseDataStream();</span><br><span class="line">            String body &#x3D; StreamUtils.copyToString(stream, Charset.forName(&quot;UTF-8&quot;));</span><br><span class="line">            String url &#x3D; context.getRequest().getRequestURL().toString();</span><br><span class="line"></span><br><span class="line">                if (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">                    &#x2F;&#x2F;验证响应结果是否为登录成功</span><br><span class="line">                    JSONObject bodyJson &#x3D; JSONObject.fromObject(body);</span><br><span class="line">                    if (bodyJson.has(ConstantPath.LOGIN_RESPONSE_STATUS)) &#123;</span><br><span class="line">                        String status &#x3D; bodyJson.getString(ConstantPath.LOGIN_RESPONSE_STATUS);</span><br><span class="line">                        if (StringUtils.equals(status, &quot;200&quot;)) &#123;</span><br><span class="line">                            if (bodyJson.has(ConstantPath.LOGIN_RESPONSE_RESULT)) &#123;</span><br><span class="line">                                JSONArray resultArray &#x3D; bodyJson.getJSONArray(ConstantPath.LOGIN_RESPONSE_RESULT);</span><br><span class="line">                                if (resultArray !&#x3D; null &amp;&amp; resultArray.size() &gt; 0) &#123;</span><br><span class="line">                                    JSONObject userObject &#x3D; resultArray.getJSONObject(0);</span><br><span class="line">                                    processLogin(context, userObject);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            context.setResponseBody(body);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            rethrowRuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    private void processLogin(RequestContext context, JSONObject userObject) &#123;</span><br><span class="line">        if (userObject.has(ConstantPath.LOGIN_USERNAME)) &#123;</span><br><span class="line">            String userName &#x3D; userObject.getString(ConstantPath.LOGIN_USERNAME);</span><br><span class="line">            &#x2F;&#x2F;将用户名存储在session中，判断用户是否登录</span><br><span class="line">            HttpServletRequest request &#x3D; context.getRequest();</span><br><span class="line">            HttpSession session &#x3D; request.getSession();</span><br><span class="line">            session.setAttribute(&quot;userName&quot;, userName);</span><br><span class="line">            session.setMaxInactiveInterval(1800);           </span><br><span class="line">            log.info(&quot;&gt;&gt;&gt;用户&gt;&gt;&gt;&quot; + userName + &quot;执行了&gt;&gt;&gt;登录&gt;&gt;&gt;操作);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String filterType() &#123;</span><br><span class="line">        return &quot;post&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int filterOrder() &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>可以看到只要理清思路Zuul和Cas的结合还是挺简单的，关键就是理清思路。</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='false'
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">实例代码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.</span> <span class="toc-text">总结</span></a></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>
<script src="/js/APlayer.min.js"></script>
<script src="/js/Meting.min.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
